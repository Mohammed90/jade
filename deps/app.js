var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var f=b++;return{value:c(f,a[f]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in b||(b[f]={});b=b[f]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,b){return b})}},"es6","es3");
$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,f=0;f<d;f++){var m=a[f];if(c.call(b,m,f,a))return{i:f,v:m}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
var sql,showConfirmation=function(a,c,b){$("#dialog_confirmation p").text(a);$("#dialog_confirmation_accept").unbind(".confirm-dialog").bind("click.confirm-dialog",b);$("#dialog_confirmation").openModal({out_duration:100,in_duration:150})},errorToast=function(a){Materialize.toast(i18n.getMessage("msg_error",a),2E3)},AppUi=function(){var a=function(a){$(".contentTab").hide();$(".sidebar a").removeClass("active");$(this).addClass("active");if("btnRunSql"==$(this).attr("id"))RunSql.show();else{a=$(this).parent().index();
var b=$(this).children("span").text();switch(a){case 2:Tables.show(b);break;case 5:Views.show(b);break;case 7:Indexes.show(b);break;case 9:Triggers.show(b)}}};return{reload:function(c){sql.send({action:"reload"},function(b){var d=$("#btnRunSql").unbind("click").click(a),f=$(".sidebar .db_entries"),f={table:[f.eq(0).empty(),"view_compact"],view:[f.eq(2).empty(),"web"],index:[f.eq(3).empty(),"list"],trigger:[f.eq(4).empty(),"settings_ethernet"]};if(b[0]){b=b[0].values;for(var m=0;m<b.length;m++){var t=
b[m][0],w=b[m][1],x=f[w];x&&(w=$('<a class="waves-effect"/>').attr("type",w).appendTo(x[0]).click(a).append($('<i class="material-icons small left"/>').text(x[1])).append($("<span/>").text(t)),c&&t==c&&(d=w))}}d.click()})}}}(),moreOptionsClicked=function(a,c){switch(a){case 0:FileIO.open(openDb);break;case 1:AppUi.reload();break;case 2:DbSettings.show();break;case 4:a={preserveBlobs:!0,action:"export"};var b;switch(c){case 0:a.type=["table"];a.includeDrop=!0;a.includeData=!0;b="tables.sql";break;
case 1:a.type=["table","view","index","trigger"];a.includeDrop=!0;a.includeData=!0;b="database.sql";break;case 2:a.type=["table","view","index","trigger"];b="dbstructure.sql";break;case 3:CSVExport.show()}if(!b)break;FileIO.save(a,b);break;case 5:FileIO.open(importSql,!0)}},openDb=function(a,c){var b=new SQL(a,function(d){d.error?(errorToast(d.error),b.terminate()):(sql.terminate(),sql=b,sql.saveTarget=c,AppUi.reload(),$("#size-menu label").text(a.name))})},saveDB=function(){FileIO.save({preserveBlobs:!0,
action:"exportDB"},$("#size-menu label").text(),sql.saveTarget)},importSql=function(){var a=function(a){$("#start_sql_import").hasClass("disabled")||($("#import_sql p").hide(),$("#start_sql_import").addClass("disabled"),$("#import_sql .progress").show().children().css("width","0%"),$("#btn_cancel_import").hide(),sql.send({preserveBlobs:!0,action:"import",transaction:$("#chkTransaction").is(":checked"),file:a},c))},c=function(a){void 0!=a.progress?$("#import_sql .progress > div").css("width",100*a.progress+
"%"):(a.error?($("#import_sql .progress").hide(),$("#import_sql pre").show().text(a.error),$("#import_sql b").show().text(void 0!=a.line?i18n.getMessage("msg_error_at_line",[a.line]):i18n.getMessage("msg_error_import")),$("#btn_cancel_import").show()):($("#import_sql").closeModal(),Materialize.toast(i18n.getMessage("msg_import_complete"),2E3)),AppUi.reload())};return function(b){$("#import_sql h4").text(i18n.getMessage("title_import",b.name));$("#import_sql p").show().children("input").attr("checked",
"checked");$("#import_sql .progress, #import_sql b, #import_sql pre").hide();$("#btn_cancel_import").show();$("#start_sql_import").removeClass("disabled").unbind(".appui").bind("click.appui",a.bind(this,b));$("#import_sql").openModal({out_duration:100,in_duration:150,dismissible:!1})}}();
$(function(){i18n.onLoad(function(){$("[i18n-id]").each(function(){var a=i18n.getMessage($(this).attr("i18n-id"));$(this).attr("i18n-attr")?$(this).attr($(this).attr("i18n-attr"),a):$(this).text(a)});sql=new SQL(null,AppUi.reload);$("#btn_add_table").click(Tables.showAdd);window.Hammer||(window.Hammer=function(){},window.Hammer.prototype.on=function(){});var a=new PopupMenu("menu_open","menu_reload","title_db_properties",null,["menu_export","menu_export_tables","menu_export_db","menu_export_db_structure",
"menu_export_csv"],"title_import_sql");a.attachTo($("#app_more_options"));a.onPopupItemClicked=moreOptionsClicked;$("#save-db").click(saveDB)})});
var CSVExport=function(){var a,c,b,d=function(){var d={action:"exportCSV",preserveBlobs:!0,data:b,seperator:[",",";","|","\t"][a.items.indexOf($("#csvSeparator").val())],includeHeader:$("#chkIncludeHeader").is(":checked"),enclosing:c.items.indexOf($("#csvEncloseFields").val())};FileIO.save(d,"output.csv");$("#export_csv").closeModal()};return{show:function(){(b=$(".table-container:visible").data("datagrid-data"))?(a||(a=new PopupMenu,a.items=["Comma (,)","Semicolor (;)","Pipe (|)","Tab"],a.translated=
!0,a.attachTo($("#csvSeparator").val(a.items[0])),c=new PopupMenu,c.items=["If needed","Always","Never"],c.translated=!0,c.attachTo($("#csvEncloseFields").val(c.items[0])),$("#btn_start_csv_export").click(d)),$("#export_csv").openModal({out_duration:100,in_duration:120,dismissible:!1})):errorToast("No output to export")}}}(),DbSettings=function(){var a={},c,b=function(a){var b=$(this).val();b.match(/^\-?[0-9]+$/)&&parseInt(b)>=parseInt($(this).attr("min"))?$(this).attr("last-number-input",$(this).val()):
(a.stopPropagation(),a.preventDefault(),$(this).val($(this).attr("last-number-input")).change())},d=function(){var a={};$("#db_settings input").each(function(){var b=$(this).attr("property-name");if(b){var c=$(this).attr("original-value"),d=$(this).is("[type='checkbox']")?$(this).is(":checked")?"1":"0":$(this).val();c!=d&&(a[b]=d)}});return a},f=function(){$.isEmptyObject(d())?$("#accept_db_settings").addClass("disabled"):$("#accept_db_settings").removeClass("disabled")},m=function(){if(!$(this).hasClass("disabled")){var a=
d();$(this).addClass("disabled");if(!$.isEmptyObject(a)){$("#db_settings input").attr("disabled","disabled");var b="",c;for(c in a)b+="PRAGMA "+c+" = "+a[c]+";";sql.send({action:"exec",preserveBlobs:!0,sql:b},function(a){a.error?(errorToast(a.error),$("#db_settings input").removeAttr("disabled"),$("#accept_db_settings").removeClass("disabled")):(Materialize.toast(i18n.getMessage("msg_db_properties_updated"),1E3),$("#db_settings").closeModal())})}}},t=function(){$("#db_settings tbody").empty();for(var b in a)a[b].remove()};
return{show:function(){c||(c={db_setting_section_versioning:{schema_version:0,user_version:0,application_id:0},db_setting_section_pages_or_sizes:{page_size:"512 1024 2048 4096 8192 16384 32768 65536".split(" "),page_count:1,max_page_count:0,journal_mode:"Delete Truncate Persist Memory Wal Off".split(" "),journal_size_limit:-1,wal_autocheckpoint:0,cache_size:0,cache_spill:2},db_setting_section_file_io:{legacy_file_format:2,locking_mode:["Normal","Exclusive"],query_only:2,secure_delete:2,synchronous:["Off",
"Normal","Full"],mmap_size:0},db_setting_section_others:{auto_vacuum:["None","Full","Incremental"],automatic_index:2,busy_timeout:0,foreign_keys:2,defer_foreign_keys:2,encoding:1,read_uncommitted:2,recursive_triggers:2,reverse_unordered_selects:2}});$("#db_settings tbody").empty();$("#accept_db_settings").addClass("disabled").unbind("click").click(m);var d="",x;for(x in c)for(var z in c[x])d+="PRAGMA "+z+";";sql.send({action:"exec",preserveBlobs:!0,sql:d},function(d){if(d.error)errorToast(d.error);
else{var e=$("#db_settings tbody"),p=0,y;for(y in c){var g=c[y];$("<td colspan=2>").appendTo($("<tr/>").appendTo(e)).text(i18n.getMessage(y));for(var q in g){var v=g[q],u=d[p++].values[0][0],n=$("<tr/>").appendTo(e).append($("<td/>").text(i18n.getMessage("db_setting_"+q))),n=$("<td>").appendTo(n),l;if(v.constructor==Array){l=$('<input type="text" readonly>').appendTo(n);$("<span/>").appendTo(n.addClass("combo-box"));n=a[q];n||(n=new PopupMenu,n.items=v,n.translated=!0,a[q]=n);for(var m=0;m<n.items.length;m++)n.items[m].toUpperCase()==
(u+"").toUpperCase()&&l.val(n.items[m]);""==l.val()&&("number"==typeof u&&n.items[u]?l.val(n.items[u]):l.val(n.items[0]));u=l.val();n.attachTo(l)}else switch(v){case 0:case -1:l=$('<input type="number">').appendTo(n).val(u).attr("min",v);l.attr("last-number-input",l.val()).change(b);break;case 1:l=$('<input type="text" readonly>').appendTo(n).val(u);break;case 2:l=$('<div class="switch"><label>'+i18n.getMessage("label_off")+' <input type="checkbox"><span class="lever"></span> '+i18n.getMessage("label_on")+
"</label></div>").appendTo(n).find("input"),1==u&&l.attr("checked","checked")}1!=v&&l.attr("property-name",q).attr("original-value",u).change(f)}}}});$("#db_settings").openModal({out_duration:100,in_duration:120,dismissible:!1,complete:t})}}}(),FileIO=function(){var a=function(a){var b=$("<input type='file' />");b.change(function(){this.files&&this.files[0]&&a&&a(this.files[0])});b.click()},c=function(a,b){var c=$("<a/>").get(0);c.download=b;sql.send(a,function(a){a.error?errorToast(a.error):(a=URL.createObjectURL(a.blob),
c.href=a,c.dispatchEvent(new MouseEvent("click")),URL.revokeObjectURL(a))})},b=function(a,b){var c=$("<a/>").get(0);c.download=b;c.href=a;window.setTimeout(function(){c.dispatchEvent(new MouseEvent("click"))},10)},d=function(a,b){chrome.fileSystem.chooseEntry({type:b?"openFile":"openWritableFile"},function(b){b&&b.file(function(e){return a(e,b)})})},f=function(a,b){var c=function(a,b){var e=Date.now(),c=function(){a.readyState===a.WRITING&&4E3>Date.now()-e?setTimeout(c,100):a.readyState===a.WRITING?
(console.error("Write operation taking too long, aborting! (current writer readyState is "+a.readyState+")"),a.abort()):b()};setTimeout(c,100)};b(function(b){a.createWriter(function(a){a.truncate(b.size);c(a,function(){a.onwriteend=function(){Materialize.toast(i18n.getMessage("msg_file_saved"),1E3)};a.seek(0);a.write(b)})})})},m=function(a){return function(b){sql.send(a,function(a){a.error?errorToast(a.error):b(a.blob)})}},t=function(a,b,c){c?f(c,m(a)):chrome.fileSystem.chooseEntry({type:"saveFile",
suggestedName:b},function(b){b&&f(b,m(a))})},w=function(a,b){var c=function(b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(a){200==this.status&&b(new Blob([this.response]))};c.send()};chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:b},function(a){a&&f(a,c)})};return chrome&&chrome.fileSystem?{save:t,open:d,download:w}:{save:c,open:a,download:b}}(),i18n=function(){if(chrome&&chrome.i18n&&chrome.i18n.getMessage)return{getMessage:chrome.i18n.getMessage,
onLoad:function(a){a()}};var a;if(navigator.languages)a=navigator.languages;else{var c=navigator.userLanguage||navigator.language;"string"==typeof c&&(a=[c],0<c.indexOf("-")&&a.push(c.substr(0,c.indexOf("-"))))}0>a.indexOf("en")&&a.push("en");c=$.when.apply($,a.map(function(b,c){var d=$.Deferred();a[c]={};$.getJSON("_locales/"+b+"/messages.json").done(function(b){a[c]=b}).always(function(){d.resolve()});return d}));c.done(function(){a.reverse();a=$.extend.apply($,a)});return{getMessage:function(b,
c){if(a[b])b=a[b].message;else return"";if(void 0==c||null==c)return b;c.constructor!=Array&&(c=[c]);return b.replace(/\$\d+/g,function(a){a=parseInt(a.substring(1))-1;return void 0!=c[a]?c[a]:""})},onLoad:c.done}}(),SQL=function(a,c){this._counter=0;this.callbacks={};var b=this;this.worker=new Worker("worker/sql.worker.js");this.worker.onmessage=function(a){b._handleResponse(a.data)};this.send({action:"open",file:a},c)};
SQL.prototype._handleResponse=function(a){this.callbacks[a.id]&&(this.callbacks[a.id](a),a.partialResponse||delete this.callbacks[a.id])};SQL.prototype.send=function(a,c){var b=this._counter++;a.id=b;this.callbacks[b]=c;this.worker.postMessage(a)};SQL.prototype.terminate=function(){this.worker.terminate()};var escapeSql=function(a){return"'"+a.replace(/'/g,"''")+"'"};function noop(){}
(function(a){var c,b,d=function(a,b){return a.children().first().children().eq(2*b)},f=function(a,b){return void 0!=b?a.find(".table-body span:nth-child("+(b+1)+")"):f(a.closest(".table-container"),a.index()/2)},m=function(b){if(1==b.which){b.preventDefault();var c=(a(this).index()-1)/2,e=a(this).closest(".table-container"),g=e.find(".table-body span:nth-child("+(c+1)+")"),d=a(this).prev(),p=a(this).addClass("active");d.parent().addClass("active");var y=d.width(),f=parseInt(d.css("min-width"),10),
h=b.pageX,k=e.find("resizebar");0==k.length&&(k=a("<resizebar/>").appendTo(e));var A=a(this).position().left+(a(this).width()-k.width())/2;k.css({left:A,transform:a(this).parent().css("transform")}).show();a(document).bind("mousemove.datagrid",function(a){var b=a.pageX-h;b+y<f&&(b=f-y);d.width(y+b);g.width(y+b);k.css("left",A+b);a.preventDefault()}).bind("mouseup.datagrid",function(){a(document).unbind(".datagrid");p.removeClass("active");k.hide();d.parent().removeClass("active")})}},t=function(b){a(this).hasClass("active")||
(a(this).parent().children(".active").removeClass("active"),a(this).parent().parent().data("grid-options").onRowSelect(a(this).addClass("active").index()))},w=function(a){var b=this.scrollTop(),c=Math.min(b,100)/100;a.css({transform:"translateY("+b+"px)",boxShadow:"0 0 "+4*c+"px rgba(0,0,0,"+.14*c+"), 0 "+4*c+"px "+8*c+"px rgba(0,0,0,"+.28*c+")"})},x=function(b){b.preventDefault();b=a(this).closest(".table-container");var c=b.data("grid-options"),e=c.allowEdit(a(this).index()),g=a(this).data("grid-value");
if(e||null!=g){var p=a("#daragrid_dialog").show().removeClass("has-blob");p.find("h4").text(d(b,a(this).index()).text());var f,m=p.find("img");null!=g&&g.blobType?("blob"==g.blobType?i18n.getMessage("column_type_blob_size",g.length):f=i18n.getMessage("column_type_blob_data",[g.length,g.blobType]),a("#daragrid_dialog_blob").text(f),p.addClass("has-blob"),a("#daragrid_dialog #daragrid_dialog_download").unbind(".datagrid").bind("click.datagrid",function(){FileIO.download(g.blobUrl,a("#daragrid_dialog h4").text()+
"."+g.blobType)}),"gif"!=g.blobType&&"jpg"!=g.blobType&&"png"!=g.blobType||m.attr("src",g.blobUrl)):f=null==g?"":g;var r=a("#daragrid_cell_text").val(f);!e&&p.hasClass("has-blob")||r.keyup().focus().select();var h=function(){a(document).unbind(".datagrid-prompt");p.hide();r.unbind(".datagrid-prompt");m.removeAttr("src")};if(e){p.addClass("allow-edit");r.removeAttr("readOnly").focus().select();var k=a(this),A=function(b){h();var e=[];k.parent().children().each(function(){e.push(a(this).data("grid-value"))});
c.onSave(k.index(),b,e,function(a){y(k,a)})};a("#daragrid_dialog_save").unbind("click").click(function(){a(this).hasClass("disabled")||A(r.val())}).addClass("disabled");r.bind("keyup.datagrid-prompt",function(b){a("#daragrid_dialog_save").removeClass("disabled")});a("#daragrid_dialog_delete").unbind("click").click(function(){A(null)});a("#daragrid_dialog_upload input").remove();a('<input type="file" />').prependTo("#daragrid_dialog_upload").change(function(a){A(this.files[0])})}else p.removeClass("allow-edit"),
r.attr("readonly","readonly");f=a(this).offset();p.css({left:Math.min(a(document).width()-p.width()-10,f.left),bottom:Math.max(a(document).height()-p.height()-f.top,10)});a(document).bind("mousedown.datagrid-prompt",function(b){a.contains(p.get(0),b.target)||h()}).bind("keyup.datagrid-prompt",function(a){27==a.which&&h()})}},z=function(b){b=a(this).parent();a(this).remove();b=b.prev().prev().removeClass("column-hidden");b.index();f(b).removeClass("column-hidden");b.children("column-expand-button").click()},
B=function(b){var c=this.parent();0==b?(c.addClass("column-hidden"),f(c).addClass("column-hidden"),a("<column-expand-button/>").prependTo(c.next().next()).click(z)):e(c)},e=function(b){var e=getComputedStyle(b.get(0),null);c.font=e.font;var p=Math.max(c.measureText(b.text()).width,parseInt(e.minWidth,10)),e=f(b);e.get(0)&&(c.font=getComputedStyle(e.get(0),null).font,e.each(function(){p=Math.max(p,c.measureText(a(this).text()).width)}));e.width(p);b.width(p)},p=function(b){e(a(this).parent())},y=function(a,
b){a.data("grid-value",b);null==b?a.text(i18n.getMessage("column_type_null")).addClass("no-display-value"):b.blobType?a.text(i18n.getMessage("column_type_blob_size",[b.length])).addClass("no-display-value"):a.text(b).removeClass("no-display-value")};a.fn.datagrid=function(e,d){d=a.extend({allowEdit:function(){return!1},onSave:function(){},onRowSelect:function(){},preserveHead:!1},d);c||(c=a("<canvas />").get(0).getContext("2d"),c.imageSmoothingEnabled=!1);b||(b=new PopupMenu("menu_hide_column","menu_auto_size"),
b.onPopupItemClicked=B);var f=this.scrollTop(0).data("grid-options",d).addClass("table-container"),g=e.columns.length,n,l=[],q;if(d.preserveHead)n=f.children(".table-body").empty(),f.children(".header").children("label").each(function(){l.push([a(this).width(),a(this).hasClass("column-hidden")])});else{f.empty().data("datagrid-data",e);var r=a("<div>").addClass("header").appendTo(f);f.unbind("scroll").scroll(w.bind(f,r));for(var h=0;h<g;h++){var k=a("<label>").append(a("<span/>").text(e.columns[h]).dblclick(p)).appendTo(r);
a("<resizeend>").html("&nbsp;").appendTo(r).mousedown(m);b.attachTo(a("<column-menu-button/>").appendTo(k));0==h&&(headFont=getComputedStyle(k.get(0),null),c.font=headFont.font,q=parseInt(headFont.minWidth,10));l[h]=[Math.max(c.measureText(e.columns[h]).width,q),h]}a("<label>").html("<span>&nbsp;</span>").appendTo(r);n=a("<div>").addClass("table-body")}for(h=0;h<e.values.length;h++){q=a("<div>").appendTo(n).click(t);for(r=0;r<g;r++)k=a("<span>").appendTo(q).dblclick(x),y(k,e.values[h][r]),d.preserveHead?
(k.width(l[r][0]+5),l[r][1]&&k.addClass("column-hidden")):(0==h&&0==r&&(c.font=getComputedStyle(k.get(0),null)),l[r][0]=Math.max(c.measureText(k.text()).width,l[r][0]));a("<span>").appendTo(q)}if(!d.preserveHead){g=f.width()-100-26*g;for(h=q=0;h<l.length;h++)q+=l[h][0];e=function(b){return n.children().map(function(){return a(this).children().get(b)})};d=f.children().first().children();if(q<g)for(q=g/q,h=0;h<l.length;h++)g=l[h][0]*q,e(h).css("width",g+26),d.eq(2*h).css("width",g+21);else for(l.sort(function(a,
b){return a[0]-b[0]}),q=g,r=l.length,k=100,h=0;h<l.length;h++)r--,l[h][0]<k?(g=l[h][0],q-=g,k=0>=r?100:Math.max(100,q/r)):(g=k,q-=g),e(l[h][1]).css("width",g+26),d.eq(2*l[h][1]).css("width",g+21);n.appendTo(f)}return this};a.fn.datagridRowValues=function(b){var c=[];this.children(".table-body").children().eq(b).children().each(function(){c.push(a(this).data("grid-value"))});return c}})(jQuery);
var PopupMenu=function(){function a(){this.lastShown=null;this.items=$.extend([],arguments)}var c=function(a,b,c){a=$("<ul class='popup-menu' />").appendTo(a);for(var e=0;e<b.length;e++){var d=$("<li/>").appendTo(a);if(null==b[e])d.addClass("separator");else{var f;b[e].constructor===Array?(d.addClass("has-sub-popup").data("popup-children",b[e]),f=b[e][0]):f=b[e];c||(f=i18n.getMessage(f));$("<span class='waves-effect'/>").appendTo(d).text(f)}}return a};a.prototype.attachTo=function(a){var b=f.bind(this,
a);a.is("input")?(a.next().click(b),a.attr("readonly")?(a.click(b),a.keydown(x.bind(this,a,!0))):a.keyup(x.bind(this,a,!1))):a.click(b)};a.prototype.remove=function(){this.el&&(this.el.remove(),this.el=null)};a.prototype.onPopupItemClicked=function(a){};var b=function(a){$(document).unbind(".popup-menu");this.lastShown&&(a?this.el.stop().fadeOut("slow"):this.el.hide(),this.lastShown.removeClass("active").unbind(".popup-menu"),this.lastShown=null,this.lastParents.unbind(".popup-menu"),this.lastParents=
null);this.selectionIndex=-1},d=function(a){a.children(".selected").removeClass("selected").children("ul").hide()},f=function(a,f){if(this.lastShown){if(this.lastShown[0]==a[0]){this.autoShow&&(this.autoShow=f);return}b.call(this)}var e=a.is("input");if(!e||!a.is(":disabled")){this.el||(this.el=c(document.body,this.items,this.translated).addClass(e?"combo_popup":"abs_popup"),e?this.el.find("span").mousedown(B.bind(this)):this.el.find("span").click(m.bind(this)));d(this.el);var g=b.bind(this,!1);if(e)a.is(":focus")||
a.focus(),a.attr("readonly")?(this.selectionIndex=this.items.indexOf(a.val()),f=this.el.children().eq(this.selectionIndex).addClass("selected"),this.el.show(),e=a.offset(),f=f.position(),this.el.width(a.parent().outerWidth()).css({left:e.left,top:e.top-f.top}).velocity({translateY:[0,f.top+(a.parent().outerHeight()-this.el.outerHeight())/2],scaleY:[1,a.parent().outerHeight()/this.el.outerHeight()]},{duration:150,easing:"easeOutExpo"})):(e=a.offset(),this.el.width(a.parent().outerWidth()).show().css({left:e.left,
top:e.top+a.height(),maxHeight:$(document).height()-e.top-a.height()-20}).velocity({translateY:[0,-this.el.outerHeight()/2],scaleY:[1,0]},{duration:150,easing:"easeOutExpo"}),this.selectionIndex=-1,this.autoShow=f),a.bind("blur.popup-menu",g);else{e=a.offset();f=Math.max(Math.min($(document).width()-this.el.width()-10,e.left),0);var p=Math.max(Math.min(e.top+a.height(),$(document).height()-this.el.outerHeight()),0),t=this.el.css({left:f,top:p}).show().velocity({translateX:[0,e.left-f+(a.outerWidth()-
this.el.outerWidth())/2],translateY:[0,-(a.outerHeight()+this.el.outerHeight())/2],scaleX:[1,a.outerHeight()/this.el.outerHeight()],scaleY:[1,a.outerWidth()/this.el.width()]},{duration:200,easing:"easeOutExpo"});a.addClass("active");$(document).bind("mousedown.popup-menu",function(a){$.contains(t.get(0),a.target)||(a.stopPropagation(),a.preventDefault(),g())})}this.lastParents=a.parents().bind("scroll.popup-menu",g);this.lastShown=a}},m=function(a){var e=$(a.target).parent();if(e.hasClass("has-sub-popup")){d(e.parent());
e.addClass("selected");a=e.children("ul");0==a.length&&(a=e.data("popup-children").slice(1),a=c(e,a,this.translated).addClass("abs_popup"),a.find("span").click(m.bind(this)));d(a);a.show();var f=e.offset(),g=f.left,f=f.top,e=e.width(),q=a.width(),v;a.outerHeight();var u=$(window).height();v=a.get(0).scrollHeight;f+v<u?(f=-16,a.removeClass("has_scroll").outerHeight(v)):u>=v+16?(f=u-f-v-16,a.removeClass("has_scroll").outerHeight(v)):(f=-f,a.addClass("has_scroll").outerHeight(u));g=g+e+q<$(document).width()?
e:-q;a.css({left:g,top:f}).velocity({translateX:[0,-g/2],opacity:[1,.6]},{duration:200,easing:"easeOutExpo"})}else a=t(e,[]),g=this.lastShown,b.call(this,!0),this.onPopupItemClicked.apply(g,a)},t=function(a,b){b.unshift(a.index());a=a.parent().parent();a.hasClass("has-sub-popup")&&t(a,b);return b},w=function(a){this.el.children(".selected").removeClass("selected");if(-1==a)this.selectionIndex=-1;else{0>a?a=this.items.length-1:a>=this.items.length&&(a=0);this.selectionIndex=a;var b=this.el.children().eq(a).addClass("selected");
a=b.position().top;var b=b.height(),c=this.el.height();0>a?this.el.scrollTop(this.el.scrollTop()+a):a+b>c&&this.el.scrollTop(this.el.scrollTop()+a+b-c)}},x=function(a,c,d){var e=d.keyCode;if(c&&(32==e&&(e=13),!this.lastShown&&(40==e||38==e||13==e))){f.call(this,a);d.preventDefault();d.stopPropagation();return}switch(e){case 40:f.call(this,a);w.call(this,this.selectionIndex+1);d.preventDefault();d.stopPropagation();break;case 38:f.call(this,a);w.call(this,c&&0==this.selectionIndex?this.items.length-
1:this.selectionIndex-1);d.preventDefault();d.stopPropagation();break;case 13:-1<this.selectionIndex&&a.val(this.el.children().eq(this.selectionIndex).text()).trigger("input").trigger("change");case 27:d.preventDefault();d.stopPropagation();this.lastShown&&27==e&&c&&a.keyup(z);b.call(this);break;default:if(!c&&(!this.lastShown||this.autoShow)){c=a.val().toLocaleLowerCase();if(""!=c)for(d=0;d<this.items.length;d++)if(0==this.items[d].toLocaleLowerCase().indexOf(c)){f.call(this,a,!0);w.call(this,d);
return}b.call(this)}}},z=function(a){27==a.keyCode&&(a.preventDefault(),a.stopPropagation(),$(this).unbind("keyup",z))},B=function(a){a.preventDefault();a.stopPropagation();this.lastShown.val($(a.target).text()).trigger("input").trigger("change").focus();b.call(this)};return a}(),RunSql=function(){function a(a){sql.send({action:"exec",sql:b.getValue()},function(a){a.error?Materialize.toast("Error "+a.error,2E3):a[0]?$("#cardSqlResult").empty().show().datagrid(a[0]):$("#cardSqlResult").empty().hide()})}
var c=!1,b,d=function(a,c){var d=[["SELECT * FROM tableName","SELECT [ALL | DISTINCT] result FROM table-list WHERE expr","SELECT [ALL | DISTINCT] result [FROM table-list] [WHERE expr] [GROUP BY expr-list] [HAVING expr] [compound-op select]* [ORDER BY sort-expr-list] [LIMIT integer [( OFFSET | , ) integer]]"],"DELETE FROM tableName [WHERE expr];INSERT INTO tableName [(column-list)] VALUES(value-list);INSERT INTO tableName [(column-list)] select-statement;UPDATE tableName SET assignment [, assignment]* [WHERE expr];REPLACE INTO tableName [(column-list)] VALUES(value-list);REPLACE INTO tableName [(column-list)] select-statement".split(";"),
["CREATE TABLE IF NOT EXISTS tableName (column-def [, column-def]* [, constraint]*","CREATE TEMP TABLE IF NOT EXISTS tableName (column-def [, column-def]* [, constraint]*","CREATE TABLE tableName AS select-statement","CREATE TEMP TABLE tableName AS select-statement",null,"ALTER TABLE old_tableName RENAME TO new_tableName","ALTER TABLE x ADD COLUMN column-def",null,"CREATE INDEX IF NOT EXISTS indexName ON tableName ( columnName [, columnName]* )","CREATE UNIQUE INDEX IF NOT EXISTS indexName ON tableName ( columnName [, columnName]* )",
"CREATE [TEMPORARY] VIEW IF NOT EXISTS viewName AS selectStatement","CREATE [TEMPORARY] TRIGGER IF NOT EXISTS triggerName [ BEFORE | AFTER ] DELETE|INSERT|UPDATE ON tableName [ FOR EACH ROW ] [ WHEN expression ] BEGIN  semicolon-terminated-update-delete-select-or-insert-statements END"],["DROP TABLE tableName","DROP VIEW viewName","DROP INDEX indexName","DROP TRIGGER triggerName"],["REINDEX tableName","REINDEX indexName","REINDEX collationName"],["PRAGMA table_info (tableName)","PRAGMA index_list (tableName)",
"PRAGMA index_info (indexName)",null,"PRAGMA database_list","PRAGMA collation_list"]];d[a]&&d[a][c]&&(b.setValue(d[a][c]),b.focus())};return{show:function(){$("#contentRunSql").show();if(!c){c=!0;b=CodeMirror.fromTextArea($("#contentCodeMirror").get(0),{mode:"text/x-mariadb",value:"SELECT * FROM mytable",indentWithTabs:!0,lineWrapping:!0,smartIndent:!0,lineNumbers:!0,autofocus:!0,extraKeys:{"Ctrl-Enter":a,"Cmd-Enter":a}});$("#btnExecuteSql").click(a);var f=new PopupMenu(["Select","SELECT * FROM tableName",
"SELECT with WHERE clause","SELECT (general)"],"Data Manipulation;DELETE;INSERT values;INSERT using select;UPDATE;REPLACE values;REPLACE using select".split(";"),["Create / Alter","CREATE TABLE","CREATE TEMP TABLE","CREATE TABLE x AS select-statement","CREATE TEMP TABLE x AS select-statement",null,"ALTER TABLE x RENAME TO y","ALTER TABLE x ADD COLUMN column-def",null,"CREATE INDEX","CREATE UNIQUE INDEX","CREATE VIEW","CREATE TRIGGER"],["Drop","DROP TABLE","DROP VIEW","DROP INDEX","DROP TRIGGER"],
["Reindex","REINDEX tableName","REINDEX indexName","REINDEX collationName"],["PRAGMA","PRAGMA table_info","PRAGMA index_list","PRAGMA index_info",null,"PRAGMA database_list","PRAGMA collation_list"]);f.translated=!0;f.attachTo($("#btnSqlTemplates"));f.onPopupItemClicked=d}$("#cardSqlResult").empty().hide()}}}();function PropertyManager(a,c,b){this.name=a;this.type=c;this.pragma=b}
PropertyManager.prototype.load=function(a){$("#propertyContent").show();$("#propertySql .card-title").text(this.name);$("#propertyContent .buttonbar").hide();$("#propertyColumns").hide();var c=this;a=$("#propertyCodeMirror");var b=a.data("codemirror");b||(b=CodeMirror.fromTextArea(a.get(0),{mode:"text/x-mariadb",autofocus:!0,readOnly:!0,lineWrapping:!0}),a.data("codemirror",b),b.setValue(""));a="SELECT sql FROM sqlite_master where name = "+escapeSql(this.name);this.pragma&&(a=a+"; PRAGMA "+this.pragma+
"("+escapeSql(this.name)+");");sql.send({action:"exec",sql:a},function(a){a.error?errorToast(a.error):a[0]?(c.success=!0,$("#propertyContent .buttonbar").show(),$("#btn_property_delete").unbind(".property-manager").bind("click.property-manager",c.confirmDelete.bind(c)),b.setValue(a[0].values[0][0]),a[1]&&($("#propertyColumns").show(),$("#propertyColumns .table-container").datagrid(a[1]))):(Materialize.toast(i18n.getMessage("msg_error_property_not_found",[c.type,c.name]),2E3),AppUi.reload())})};
PropertyManager.prototype.confirmDelete=function(){showConfirmation(i18n.getMessage("msg_confirm_delete_property",[this.type,this.name]),i18n.getMessage("btn_delete"),this.deleteItem.bind(this))};PropertyManager.prototype.deleteItem=function(){sql.send({action:"exec",sql:"drop "+this.type+" if exists "+escapeSql(this.name)},function(a){a.error?errorToast(a.error):AppUi.reload()})};
var Indexes=function(){return{show:function(a){(new PropertyManager(a,"index","index_xinfo")).load()}}}(),Triggers=function(){return{show:function(a){(new PropertyManager(a,"trigger")).load()}}}(),Tables=function(){var a,c=!1,b,d,f,m,t=function(b,c,d,f){c.data("row-value",b);var e=a.cols.values[c.index()],k=a.hasPrimaryKey&&1==e[a.pkIndex],g=!1;null==b?e=i18n.getMessage(k?"column_type_primary_key":"column_type_default_value",e[a.typeIndex]):b instanceof File?e=i18n.getMessage("column_type_blob_file",
b.name):null!=b&&b.blobType?e=i18n.getMessage("column_type_blob_data",[b.length,b.blobType]):(e=i18n.getMessage("column_type_empty_string",e[a.typeIndex]),g=!0);g&&f&&d.val(b);20<d.attr("placeholder",e).val().length?c.addClass("long_text"):c.removeClass("long_text")},w=function(){t($(this).val(),$(this).closest(".column_entry"),$(this))},x=function(){var a=$(this).closest(".column_entry");t(null,a,a.find("textarea").val(""))},z=function(){if(this.files[0]){var a=$(this).closest(".column_entry");t(this.files[0],
a,a.find("textarea").val(""))}this.value=null},B=function(b){b.preventDefault();if(!$(this).hasClass("disabled")){$("#add_entry_dialog form textarea").attr("disabled","disabled");$("#add_entry_dialog form .icon_button").hide();var c=$(this).addClass("disabled"),d="",f="",e=[],k=a.cols.columns.indexOf("name");$("#add_entry_dialog .column_entry").each(function(b){var c=$(this).data("row-value");null!=c&&(d&&(d+=", ",f+=", "),d+=escapeSql(a.cols.values[b][k]),f+="?",e.push(c))});var g=function(a){Materialize.toast(a,
2E3);$("#add_entry_dialog form textarea").removeAttr("disabled");$("#add_entry_dialog form .icon_button").show();c.removeClass("disabled")};d?(b="INSERT iNTO "+escapeSql(a.name)+" ("+d+") VALUES ("+f+")",sql.send({action:"statement",sql:b,args:e,preserveBlobs:!0},function(b){b.error?g(i18n.getMessage("msg_error",b.error)):($("#add_entry_dialog").closeModal(),a.searchTable(a.query))})):g(i18n.getMessage("msg_error_no_values_provided"))}},e=function(c,d){b||(b=$("#add_entry_dialog form > div").first(),
$("#add_entry_accept").click(B));var f=$("#add_entry_dialog form").empty();d=d?d:[];c=a.cols.columns.indexOf("name");for(var e=0;e<a.cols.values.length;e++){var k=b.clone().appendTo(f);k.find("label").text(a.cols.values[e][c]);t(void 0!=d[e]?d[e]:null,k,k.find("textarea"),!0)}f.find(".tooltipped").tooltip();f.find("textarea").bind("input",w);f.find(".delete_button").click(x);f.find('[type="file"]').change(z);$("#add_entry_accept").removeClass("disabled");$("#add_entry_dialog").openModal({out_duration:100,
ready:function(){f.find("textarea").first().focus()}})},p=function(b){var c=$("#contentTable .table-container").datagridRowValues(a.selectedRow);e(b,c)},y=function(){var b=$("#contentTable .table-container").datagridRowValues(a.selectedRow),c=[],b=C(b,c);sql.send({action:"statement",sql:"DELETE FROM "+escapeSql(a.name)+" WHERE "+b+";",args:c},function(b){b.error?errorToast(b.error):a.searchTable(a.query)})},g=function(a){showConfirmation(i18n.getMessage("msg_confirm_delete_row"),i18n.getMessage("btn_delete"),
y)},q=function(a){a.preventDefault();if(!$(this).hasClass("disabled")){var b=$("#add_table_dialog input:disabled");$("#add_table_dialog input").attr("disabled","disabled");$("#add_table_new_column, #add_table_new_column").addClass("disabled");var c=function(a){Materialize.toast(a,2E3);$("#add_table_dialog input").removeAttr("disabled");b.attr("disabled","disabled");$("#add_table_new_column, #add_table_new_column").removeClass("disabled")},d=$("#add_table_name").val();if(""==d)c(i18n.getMessage("msg_error_no_table_name_provided")),
$("#add_table_name").focus();else{a="CREATE";$("#chkTmpTable").is(":checked")&&(a+=" TEMP");a+=" TABLE";$("#chkIfNotExist").is(":checked")&&(a+=" IF NOT EXISTS");a+=" "+escapeSql(d)+" (";var e=0,k=[],g=function(a,b){var c=a.find("[type='text']");a=a.find("[type='checkbox']");var d=c.eq(0).val();if(""==d)return null;var g=escapeSql(d)+" ",h=c.eq(1).val();""!=h&&(g=-1<f.items.indexOf(h.toUpperCase())?g+h:g+escapeSql(h));a.eq(0).is(":checked")&&(b?g+=" PRIMARY KEY":k.push(escapeSql(d)),"INTEGER"==h.toUpperCase()&&
a.eq(1).is(":checked")&&(g+=" AUTOINCREMENT",e++));a.eq(3).is(":checked")&&(g+=" UNIQUE");b=c.eq(2).val();""!=b&&(g+=" DEFAULT ",g=-1<m.items.indexOf(b.toUpperCase())?g+b:g+escapeSql(b));a.eq(2).is(":checked")||(g+=" NOT NULL");return g},h=[],l=-1,n=null;$("#columnTable tr").each(function(){var a=g($(this),!1);null!=a&&(-1==l&&0<k.length&&(l=h.length,n=$(this)),h.push(a))});if(0==h.length)c(i18n.getMessage("msg_error_no_column_provided"));else{if(1==k.length)h[l]=g(n,!0);else if(1<k.length){if(0<
e){c(i18n.getMessage("msg_error_composite_increment_key"));return}h.push("PRIMARY KEY ("+k.join(", ")+")")}a+=h.join(", ")+")";sql.send({action:"exec",sql:a},function(a){a.error?c(i18n.getMessage("msg_error",a.error)):($("#add_table_dialog").closeModal(),AppUi.reload(d))})}}}},v=function(){var a=$("#columnTable tr").length,b=d.clone().appendTo($("#columnTable tbody")),c=b.find("[type='checkbox']").each(function(b){$(this).attr("id","addTableChk"+(b+5*a)).next().attr("for","addTableChk"+(b+5*a))}),
e=b.find("[type='text']");f.attachTo(e.eq(1));m.attachTo(e.eq(2));var g=function(){c.eq(0).is(":checked")&&"INTEGER"==e.eq(1).val().toUpperCase()?c.eq(1).removeAttr("disabled"):c.eq(1).removeAttr("checked").attr("disabled","disabled")};e.bind("input",g);c.eq(0).change(g);return b},u=function(a,b){a.baseSql=b.baseSql;a.hasPrimaryKey=b.hasPrimaryKey;a.cols=b[1];a.pkIndex=b.pkIndex;a.typeIndex=b[1].columns.indexOf("type");$("#contentTable .selection-wrapper").eq(1).show();c||(c=!0,$("#table_add_entry").click(e),
$("#table_copy_entry").click(p),$("#table_delete_entry").click(g))},n=function(b){return a.hasPrimaryKey?1!=a.cols.values[b][a.pkIndex]:0!=b},l=function(b,c,d,e){var f=[];d=C(d,f);var g=a.cols.columns.indexOf("name");b=a.cols.values[a.hasPrimaryKey?b:b-1][g];var g=escapeSql(a.name),k=f.slice(0);k.unshift(c);c={action:"statement",sql:"UPDATE "+g+" SET "+escapeSql(b)+" = ? WHERE "+d+";",args:k,resultSql:"SELECT "+(g+"."+escapeSql(b))+" from "+g+" WHERE "+d+";",resultArgs:f,preserveBlobs:!0};sql.send(c,
function(a){a.error?Materialize.toast("Error "+a.error,2E3):e(a[0])})},C=function(b,c){var d=a.cols.columns.indexOf("name"),e="",f=escapeSql(a.name)+".";if(a.hasPrimaryKey){var g=a.cols.columns.indexOf("pk");$.each(a.cols.values,function(a,k){1==k[g]&&(c.push(b[a]),e&&(e+=" AND "),e+=f+escapeSql(k[d])+" = ?")})}else c=[b[0]],e="rowid = ?";return e},r=function(b){a.selectedRow=b;$("#contentTable .selection-wrapper").first().show()},h=function(a,b){$("#contentTable .selection-wrapper").first().hide();
$("#contentTable .table-container").show().datagrid(a,{allowEdit:n,onSave:l,onRowSelect:r,preserveHead:b})};return{show:function(b){a=new TableManager(b,"table");a.showGrid=h;a.onDataLoad=u;a.load({action:"load",name:b})},showAdd:function(){var a=$("#add_table_dialog .modal-content");d||(d=$("#columnTable tr").first(),f=new PopupMenu("INTEGER","BLOB","DOUBLE","FLOAT","REAL","CHAR","TEXT","VARCHAR","BLOB","NUMERIC","DATETIME"),f.translated=!0,m=new PopupMenu("CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP"),
m.translated=!0,$("#add_table_new_column").click(function(){$(this).hasClass("disabled")||v().find("[type='text']").eq(0).focus()}),$("#add_table_accept").click(q));a.remove().prependTo($("#add_table_dialog"));var b=$("#columnTableHead");a.scroll(function(){var a=b.parent().position(),a=-Math.min(0,a.top),c=Math.min(a,100)/100;b.css({transform:"translateY("+a+"px)",boxShadow:"0 0 "+4*c+"px rgba(0,0,0,"+.14*c+"), 0 "+4*c+"px "+8*c+"px rgba(0,0,0,"+.28*c+")"})}).scroll();$("#chkTmpTable, #chkIfNotExist").removeAttr("checked").removeAttr("disabled");
$("#add_table_name").val("").removeAttr("disabled");$("#columnTable tbody").empty();$("#add_table_new_column, #add_table_new_column").removeClass("disabled");for(a=0;5>a;a++)v();$("#add_table_dialog").openModal({out_duration:100,in_duration:120,ready:function(){$("#add_table_name").focus()},complete:function(){f.remove();m.remove()}})}}}(),Views=function(){var a,c=function(a,c){$("#contentTable .table-container").show().datagrid(a,{preserveHead:c})};return{show:function(b){a=new TableManager(b,"view");
a.showGrid=c;a.onDataLoad=function(){};a.baseSql="select * from "+escapeSql(b);a.load({action:"exec",sql:a.baseSql})}}}();function TableManager(a,c){this.name=a;this.type=c}
TableManager.prototype.load=function(a){$("#contentTable").show();$("#contentTable .card-title").text(this.name);$("#contentTable .buttonbar").hide();$("#contentTable .selection-wrapper").hide();$("#contentTable .table-container").empty();var c=this;sql.send(a,function(a){a.error?(Materialize.toast("Error "+a.error,2E3),AppUi.reload()):(c.success=!0,$("#contentTable .buttonbar").show(),c.onDataLoad(c,a),c.showGrid(a[0]))});$("#contentTable #search_table").val("").unbind("keypress").keypress(function(a){13==
a.which&&c.searchTable($(this).val())});$("#btnTableProperties").unbind("click").click(function(){$("#contentTable").hide();(new PropertyManager(c.name,c.type,"table_info")).load()})};TableManager.prototype.searchTable=function(a){if(this.success){var c=this;sql.send({action:"exec",sql:this.baseSql,query:a},function(b){b.error?errorToast(b.error):b[0]?(c.showGrid(b[0],!0),c.query=a):$("#contentTable .table-body").empty()})}};
